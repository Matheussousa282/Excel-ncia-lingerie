<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trabalhe Conosco</title>
<style>
:root {
  --primary: #c4a264;
  --primary-dark: #080808;
  --background: #f2f4f8;
  --text: #2e2e2e;
  --muted: #6b7280;
  --border: #d1d5db;
  --white: #ffffff;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background: linear-gradient(135deg, #000000, #c59845);
  color: var(--text);
}
.page {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.card {
  width: 100%;
  max-width: 720px;
  background: rgba(255, 255, 255, 0.92);
  border-radius: 12px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.15);
  overflow: hidden;
}
.footer-dev {
  margin-top: 20px;
  text-align: center;
  font-size: 13px;
  color: #c59845;
}
.card-header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); padding: 30px; color: #fff; }
.card-header h1 { margin: 0; font-size: 26px; }
.card-header p { margin-top: 8px; font-size: 15px; opacity: 0.9; }
.card-body { padding: 30px; }
form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.full { grid-column: span 2; }
label { font-size: 14px; font-weight: 600; margin-bottom: 6px; display: block; }
input, select, textarea { width: 100%; padding: 12px 14px; font-size: 14px; border: 1px solid var(--border); border-radius: 6px; font-family: inherit; }
textarea { resize: vertical; min-height: 120px; }
.actions { grid-column: span 2; }
button { width: 100%; padding: 14px; background: var(--primary); color: #fff; font-size: 16px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; }
button:hover { background: var(--primary-dark); }
.privacy { text-align: center; font-size: 13px; color: var(--muted); margin-top: 20px; }
@media (max-width: 640px) { form { grid-template-columns: 1fr; } .full { grid-column: span 1; } }
</style>
</head>
<body>

<div class="page">
  <div class="card">
    <div class="card-header">
      <h1>Trabalhe Conosco</h1>
      <p>Envie seu currículo e faça parte do nosso time</p>
    </div>
    <div class="card-body">
      <form id="formCandidato">
        <div><label for="nome">Nome completo</label><input id="nome" name="nome" type="text" placeholder="Digite seu nome" required /></div>
        <div><label for="telefone">Telefone</label><input id="telefone" name="telefone" type="tel" placeholder="(XX) XXXXX-XXXX" /></div>
        <div><label for="email">E-mail</label><input id="email" name="email" type="email" placeholder="seu@email.com" required /></div>
        <div><label for="cargoSelect">Cargo de interesse</label><select id="cargoSelect" name="cargo_id" required><option value="">Carregando cargos...</option></select></div>
        <div><label for="instituicaoSelect">Instituição</label><select id="instituicaoSelect" name="instituicao_id" required><option value="">Carregando instituições...</option></select></div>
        <div><label for="unidadeSelect">Unidade</label><select id="unidadeSelect" name="unidade_id" required disabled><option value="">Selecione uma instituição primeiro</option></select></div>
        <div class="full"><label for="apresentacao">Apresentação profissional</label><textarea id="apresentacao" name="apresentacao" placeholder="Fale sobre você"></textarea></div>
        <div class="full"><label for="arquivo">Currículo (PDF ou DOC)</label><input id="arquivo" name="arquivo" type="file" accept=".pdf,.doc,.docx" required /></div>
        <div class="actions full"><button type="submit">Enviar Currículo</button></div>
      </form>
      <p class="privacy">Seus dados serão utilizados exclusivamente para fins de recrutamento e seleção.</p>
      <div class="footer-dev">
        Desenvolvido por <strong>Excelencia Lingerie</strong>
      </div>
    </div>
  </div>
</div>

<script>
const cargoSelect = document.getElementById("cargoSelect");
const instituicaoSelect = document.getElementById("instituicaoSelect");
const unidadeSelect = document.getElementById("unidadeSelect");

// Função de voz
function falarMensagem(texto) {
  if ('speechSynthesis' in window) {
    const msg = new SpeechSynthesisUtterance(texto);
    msg.lang = 'pt-BR';
    msg.rate = 1;
    msg.pitch = 1;
    window.speechSynthesis.speak(msg);
  }
}

// Funções para carregar cargos, instituições e unidades
async function carregarCargos() {
  try {
    const res = await fetch("/api/cargos");
    const data = await res.json();
    cargoSelect.innerHTML = '<option value="">Selecione um cargo</option>';
    data.filter(c => c.ativo).forEach(c => {
      const o = document.createElement("option");
      o.value = c.id; o.textContent = c.nome;
      cargoSelect.appendChild(o);
    });
  } catch (err) { console.error(err); }
}

async function carregarInstituicoes() {
  try {
    const res = await fetch("/api/instituicoes");
    const data = await res.json();
    instituicaoSelect.innerHTML = '<option value="">Selecione uma instituição</option>';
    data.filter(i => i.ativo).forEach(i => {
      const o = document.createElement("option");
      o.value = i.id; o.textContent = i.nome;
      instituicaoSelect.appendChild(o);
    });
  } catch (err) { console.error(err); }
}

instituicaoSelect.addEventListener("change", async () => {
  const id = instituicaoSelect.value;
  unidadeSelect.disabled = !id;
  unidadeSelect.innerHTML = '<option value="">Carregando unidades...</option>';
  if (!id) return unidadeSelect.innerHTML = '<option value="">Selecione uma instituição primeiro</option>';
  try {
    const res = await fetch(`/api/unidades?instituicao_id=${id}`);
    const data = await res.json();
    unidadeSelect.innerHTML = '<option value="">Selecione uma unidade</option>';
    data.filter(u => u.ativo).forEach(u => {
      const o = document.createElement("option");
      o.value = u.id; o.textContent = u.nome;
      unidadeSelect.appendChild(o);
    });
  } catch (err) { console.error(err); }
});

// Envio do formulário como Base64
document.getElementById("formCandidato").addEventListener("submit", async (e) => {
  e.preventDefault();
  const file = document.getElementById("arquivo").files[0];
  if (!file) return alert("Selecione um arquivo");

  const reader = new FileReader();
  reader.onload = async () => {
    const base64 = reader.result.split(",")[1];

    const body = {
      nome: document.getElementById("nome").value,
      telefone: document.getElementById("telefone").value,
      email: document.getElementById("email").value,
      cargo_id: document.getElementById("cargoSelect").value,
      instituicao_id: document.getElementById("instituicaoSelect").value,
      unidade_id: document.getElementById("unidadeSelect").value,
      apresentacao: document.getElementById("apresentacao").value,
      arquivo_base64: base64,
      arquivo_nome: file.name
    };

    try {
      const res = await fetch("/api/candidatos", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      if (res.ok) {
        alert("Currículo enviado com sucesso!");
        falarMensagem("Seu currículo foi enviado com sucesso. Boa sorte!");
        document.getElementById("formCandidato").reset();
        unidadeSelect.disabled = true;
      } else {
        const txt = await res.text();
        alert("Erro ao enviar: " + txt);
      }
    } catch (err) {
      console.error(err);
      alert("Erro ao enviar formulário");
    }
  };

  reader.readAsDataURL(file);
});

// Inicializar selects
carregarCargos();
carregarInstituicoes();
</script>

</body>
</html>
