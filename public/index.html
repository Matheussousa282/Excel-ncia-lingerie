<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Trabalhe Conosco</title>

<style>
:root {
  --primary: #0052cc;
  --primary-dark: #003d99;
  --background: #f2f4f8;
  --text: #2e2e2e;
  --muted: #6b7280;
  --border: #d1d5db;
  --white: #ffffff;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background: var(--background);
  color: var(--text);
}

.page {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.card {
  width: 100%;
  max-width: 720px;
  background: var(--white);
  border-radius: 12px;
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}

.card-header {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  padding: 30px;
  color: #fff;
}

.card-header h1 {
  margin: 0;
  font-size: 26px;
}

.card-header p {
  margin-top: 8px;
  font-size: 15px;
  opacity: 0.9;
}

.card-body { padding: 30px; }

form {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.full { grid-column: span 2; }

label {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 6px;
  display: block;
}

input, select, textarea {
  width: 100%;
  padding: 12px 14px;
  font-size: 14px;
  border: 1px solid var(--border);
  border-radius: 6px;
  transition: 0.2s;
  font-family: inherit;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(0, 82, 204, 0.15);
}

textarea { resize: vertical; min-height: 120px; }

.file-input {
  border: 2px dashed var(--border);
  padding: 20px;
  text-align: center;
  border-radius: 8px;
  cursor: pointer;
}

.file-input:hover {
  border-color: var(--primary);
  background: #f8faff;
}

.actions { grid-column: span 2; }

button {
  width: 100%;
  padding: 14px;
  background: var(--primary);
  color: #fff;
  font-size: 16px;
  font-weight: 600;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

button:hover { background: var(--primary-dark); }

.privacy {
  text-align: center;
  font-size: 13px;
  color: var(--muted);
  margin-top: 20px;
}

@media (max-width: 640px) {
  form { grid-template-columns: 1fr; }
  .full { grid-column: span 1; }
}
</style>
</head>

<body>
<div class="page">
  <div class="card">
    <div class="card-header">
      <h1>Trabalhe Conosco</h1>
      <p>Envie seu currículo e faça parte do nosso time</p>
    </div>

    <div class="card-body">
      <form id="formCandidato" enctype="multipart/form-data">
        <div>
          <label for="nome">Nome completo</label>
          <input id="nome" name="nome" type="text" placeholder="Digite seu nome" required />
        </div>

        <div>
          <label for="telefone">Telefone</label>
          <input id="telefone" name="telefone" type="tel" placeholder="(XX) XXXXX-XXXX" />
        </div>

        <div>
          <label for="email">E-mail</label>
          <input id="email" name="email" type="email" placeholder="seu@email.com" required />
        </div>

        <div>
          <label for="cargoSelect">Cargo de interesse</label>
          <select id="cargoSelect" name="cargo_id" required>
            <option value="">Carregando cargos...</option>
          </select>
        </div>

        <div>
          <label for="instituicaoSelect">Instituição</label>
          <select id="instituicaoSelect" name="instituicao_id" required>
            <option value="">Carregando instituições...</option>
          </select>
        </div>

        <div>
          <label for="unidadeSelect">Unidade</label>
          <select id="unidadeSelect" name="unidade_id" required disabled>
            <option value="">Selecione uma instituição primeiro</option>
          </select>
        </div>

        <div class="full">
          <label for="apresentacao">Apresentação profissional</label>
          <textarea id="apresentacao" name="apresentacao" placeholder="Fale sobre você"></textarea>
        </div>

        <div class="full">
          <label for="arquivo">Currículo (PDF ou DOC)</label>
          <input id="arquivo" name="arquivo" type="file" accept=".pdf,.doc,.docx" required />
        </div>

        <div class="actions full">
          <button type="submit">Enviar Currículo</button>
        </div>
      </form>

      <p class="privacy">
        Seus dados serão utilizados exclusivamente para fins de recrutamento e seleção.
      </p>
    </div>
  </div>
</div>

<script>
const cargoSelect = document.getElementById("cargoSelect");
const instituicaoSelect = document.getElementById("instituicaoSelect");
const unidadeSelect = document.getElementById("unidadeSelect");

// ===== Carregar Cargos =====
async function carregarCargosAtivos() {
  try {
    const res = await fetch("/api/cargos");
    if (!res.ok) throw new Error("Erro ao buscar cargos");
    const cargos = await res.json();
    cargoSelect.innerHTML = '<option value="">Selecione um cargo</option>';
    cargos.filter(c => c.ativo).forEach(c => {
      const option = document.createElement("option");
      option.value = c.id;
      option.textContent = c.nome;
      cargoSelect.appendChild(option);
    });
  } catch (err) {
    console.error(err);
    alert("Erro ao carregar cargos");
  }
}

// ===== Carregar Instituições =====
async function carregarInstituicoesAtivas() {
  try {
    const res = await fetch("/api/instituicoes");
    if (!res.ok) throw new Error("Erro ao buscar instituições");
    const insts = await res.json();
    instituicaoSelect.innerHTML = '<option value="">Selecione uma instituição</option>';
    insts.filter(i => i.ativo).forEach(i => {
      const option = document.createElement("option");
      option.value = i.id;
      option.textContent = i.nome;
      instituicaoSelect.appendChild(option);
    });
  } catch (err) {
    console.error(err);
    alert("Erro ao carregar instituições");
  }
}

// ===== Carregar Unidades Dinâmicas =====
instituicaoSelect.addEventListener("change", async () => {
  const id = instituicaoSelect.value;
  unidadeSelect.disabled = !id;
  unidadeSelect.innerHTML = '<option value="">Carregando unidades...</option>';
  if (!id) return unidadeSelect.innerHTML = '<option value="">Selecione uma instituição primeiro</option>';

  try {
    const res = await fetch(`/api/unidades?instituicao_id=${id}`);
    if (!res.ok) throw new Error("Erro ao buscar unidades");
    const unidades = await res.json();
    unidadeSelect.innerHTML = '<option value="">Selecione uma unidade</option>';
    unidades.filter(u => u.ativo).forEach(u => {
      const option = document.createElement("option");
      option.value = u.id;
      option.textContent = u.nome;
      unidadeSelect.appendChild(option);
    });
  } catch (err) {
    console.error(err);
    alert("Erro ao carregar unidades");
  }
});

// ===== Envio do Formulário =====
const form = document.getElementById("formCandidato");
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(form);

  try {
    const res = await fetch("/api/candidatos", {
      method: "POST",
      body: formData
    });

    if (res.ok) {
      alert("Currículo enviado com sucesso!");
      form.reset();
      unidadeSelect.disabled = true;
    } else {
      let data;
      try { data = await res.json(); } catch { data = await res.text(); }
      alert("Erro: " + JSON.stringify(data));
    }
  } catch (err) {
    console.error(err);
    alert("Erro ao enviar currículo");
  }
});

// ===== Inicializar =====
carregarCargosAtivos();
carregarInstituicoesAtivas();
</script>
</body>
</html>
