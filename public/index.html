<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Enviar Currículo</title>
<style>
  body { font-family: Arial, sans-serif; background: #f2f4f8; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
  .card { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 400px; }
  h1 { margin-top: 0; color: #0052cc; }
  label { display: block; margin-top: 15px; font-weight: bold; }
  input, select, textarea, button { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; }
  button { background: #0052cc; color: #fff; border: none; cursor: pointer; margin-top: 20px; }
  button:hover { background: #003d99; }
</style>
</head>
<body>

<div class="card">
  <h1>Enviar Currículo</h1>
  <form id="formCurriculo" enctype="multipart/form-data">
    <label>Nome completo</label>
    <input name="nome" type="text" required />

    <label>E-mail</label>
    <input name="email" type="email" required />

    <label>Telefone</label>
    <input name="telefone" type="tel" />

    <label>Cargo</label>
    <select name="cargo_id" id="cargoSelect" required></select>

    <label>Instituição</label>
    <select name="instituicao_id" id="instituicaoSelect" required></select>

    <label>Unidade</label>
    <select name="unidade_id" id="unidadeSelect" required disabled></select>

    <label>Apresentação</label>
    <textarea name="apresentacao"></textarea>

    <label>Arquivo (PDF ou DOC)</label>
    <input name="arquivo" type="file" accept=".pdf,.doc,.docx" required />

    <button type="submit">Enviar</button>
  </form>
</div>

<script>
const cargoSelect = document.getElementById("cargoSelect");
const instituicaoSelect = document.getElementById("instituicaoSelect");
const unidadeSelect = document.getElementById("unidadeSelect");

// ===== Carregar cargos e instituições =====
async function carregarCargos() {
  const res = await fetch("/api/cargos");
  const data = await res.json();
  cargoSelect.innerHTML = '<option value="">Selecione um cargo</option>';
  data.filter(c=>c.ativo).forEach(c=>{
    const o = document.createElement("option");
    o.value = c.id; o.textContent = c.nome;
    cargoSelect.appendChild(o);
  });
}
async function carregarInstituicoes() {
  const res = await fetch("/api/instituicoes");
  const data = await res.json();
  instituicaoSelect.innerHTML = '<option value="">Selecione uma instituição</option>';
  data.filter(i=>i.ativo).forEach(i=>{
    const o = document.createElement("option");
    o.value=i.id; o.textContent=i.nome;
    instituicaoSelect.appendChild(o);
  });
}

// ===== Carregar unidades =====
instituicaoSelect.addEventListener("change", async ()=>{
  const id = instituicaoSelect.value;
  unidadeSelect.disabled = !id;
  if(!id) { unidadeSelect.innerHTML = '<option value="">Selecione uma instituição primeiro</option>'; return; }
  const res = await fetch(`/api/unidades?instituicao_id=${id}`);
  const data = await res.json();
  unidadeSelect.innerHTML = '<option value="">Selecione uma unidade</option>';
  data.filter(u=>u.ativo).forEach(u=>{
    const o = document.createElement("option");
    o.value=u.id; o.textContent=u.nome;
    unidadeSelect.appendChild(o);
  });
});

// ===== Envio do formulário =====
document.getElementById("formCurriculo").addEventListener("submit", async e=>{
  e.preventDefault();
  const formData = new FormData(e.target);
  try {
    const res = await fetch("/api/enviarCurriculo", { method:"POST", body: formData });
    if(res.ok){ alert("Currículo enviado com sucesso!"); e.target.reset(); unidadeSelect.disabled=true; }
    else { const txt = await res.text(); alert("Erro: "+txt); }
  } catch(err){ console.error(err); alert("Erro ao enviar"); }
});

// ===== Inicialização =====
carregarCargos();
carregarInstituicoes();
</script>

</body>
</html>
